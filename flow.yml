jtype: Flow
with:
  protocol: grpc
  port: 51005
  monitoring: true  # enable prometheus & grafana
  env:
    JINA_LOG_LEVEL: debug
executors:
  - name: dalle
    # uses: docker://jinaai/dalle_executor:latest
    uses: jinahub+docker://2583xebn
    timeout_ready: -1  # slow download speed often leads to timeout
    env:
      CUDA_VISIBLE_DEVICES: 0  # change this if you have multiple GPU
    gpus: all
    volumes:
      - $HOME/.cache:/root/.cache
      # - $HOME/.cache:/home/dalle/.cache
  - name: diffusion
    # uses: docker://jinaai/glid3_executor:latest
    uses: jinahub+docker://zcougdp9
    env:
      CUDA_VISIBLE_DEVICES: 0  # change this if you have multiple GPU
    replicas: 1
    needs: [gateway]
    gpus: all
    volumes:
      - $HOME/.cache:/root/.cache
      # - $HOME/.cache:/home/dalle/.cache
  - name: rerank
    # uses: docker://jinaai/rerank_executor:latest
    uses: jinahub+docker://wyedudam
    needs: [dalle, diffusion]
  - name: upscaler
    # uses: docker://jinaai/swinir_executor:latest
    uses: jinahub+docker://296f27y7
    env:
      CUDA_VISIBLE_DEVICES: 0  # change this if you have multiple GPU
  - name: store
    # uses: docker://jinaai/store_executor:latest
    uses: jinahub+docker://jffp33to
    volumes:
      - $PWD/db:/home/dalle/db
